---
title: "SURE 2023 - Football/Soccer"
output: html_document
date: "2023-06-21"
---
```{r, warning=FALSE}
library(devtools)
library(StatsBombR)
library(worldfootballR)
library(dplyr)
library(tidyr)
library(lubridate)
```

```{r}
Comp <- FreeCompetitions()
Matches <- FreeMatches(Comp)
fotmob_matches <- fotmob_get_matches_by_date(date = c("20210925"))
#Chelsea_ManCity <- fotmob_matches %>% 
 # filter(id == "3609981")
fotmob_matches <- c(3609994, 3610132)
match_info <- fotmob_get_match_info(fotmob_matches)
match_details_first <- fotmob_get_match_details(c(3609981))
```
```{r}
bettingPL2018 <- read.csv("E0 (1).csv")
basicInfoPL2018 <- read.csv("england-premier-league-matches-2018-to-2019-stats.csv")
```

```{r}
team_data <- read.csv("teams.csv")
team_data_2 <- read.csv("teams2.csv")
players_data <- read.csv("players.csv")
```


```{r}
bettingPL2018$HomeTeam <- 
  stri_replace_all_regex(bettingPL2018$HomeTeam,
                         pattern = c("Man United", "Bournemouth",
                                     "Huddersfield", "Newcastle",
                                     "Wolves", "Cardiff", "Leicester",
                                     "Tottenham", "West Ham", "Brighton",
                                     "Man City"),
                         replacement = c("Manchester United", 
                                         "AFC Bournemouth", 
                                         "Huddersfield Town",
                                         "Newcastle United",
                                         "Wolverhampton Wanderers",
                                         "Cardiff City", 
                                         "Leicester City", 
                                         "Tottenham Hotspur",
                                         "West Ham United", 
                                         "Brighton & Hove Albion",
                                         "Manchester City"),
                         vectorize = FALSE)

bettingPL2018$AwayTeam <- 
  stri_replace_all_regex(bettingPL2018$AwayTeam,
                         pattern = c("Man United", "Bournemouth",
                                     "Huddersfield", "Newcastle",
                                     "Wolves", "Cardiff", "Leicester",
                                     "Tottenham", "West Ham", "Brighton",
                                     "Man City"),
                         replacement = c("Manchester United", 
                                         "AFC Bournemouth", 
                                         "Huddersfield Town",
                                         "Newcastle United",
                                         "Wolverhampton Wanderers",
                                         "Cardiff City", 
                                         "Leicester City", 
                                         "Tottenham Hotspur",
                                         "West Ham United", 
                                         "Brighton & Hove Albion",
                                         "Manchester City"),
                         vectorize = FALSE)
```


```{r, warning= FALSE}
bettingPL2018 <- bettingPL2018 %>% 
  mutate(Info = paste(HomeTeam, " ", AwayTeam, "-", Date))

basicInfoPL2018 <- basicInfoPL2018 %>% mutate(datetime = as_datetime(timestamp),
                           date = as_date(datetime),
                           day = day(date),
                           month = month(date),
                           year = year(date),
                           dmy = str_c(day, month, year, sep = "/"),
                           date = format(date, "%d/%m/%Y"))


basicInfoPL2018 <- basicInfoPL2018 %>%
  mutate(Date = make_date(date_GMT),
         Info = paste(home_team_name, " ", away_team_name, "-", date))

bettingBasicPL2018 <- left_join(bettingPL2018, basicInfoPL2018, 
                                       by = "Info")

```


```{r}
#Rename
bettingBasicPL2018 <- bettingBasicPL2018 %>% 
  rename(Home_goals = FTHG, Away_goals = FTAG, Halftime_home_goals = HTHG, Halftime_away_goals = HTAG, Home_shots = HS, Away_shots = AS, Home_shots_on_target = HST, Away_shots_on_target = AST ,Home_fouls = HF, Home_cards =  HC,Away_cards = AC, Home_yellows = HY, Away_yellows = AY , Home_reds = HR, Away_reds = AR)

# FIFA Data

FIFA_players <- read.csv("players_18.csv")
```

```{r}
bettingBasicPL2018 <- bettingBasicPL2018 %>% 
  rename(Full_time_result = FTR, Half_time_result = HTR)
```

```{r}
bettingBasicPL2018 <- bettingBasicPL2018 %>% 
  mutate(
    expect_win = ifelse(((odds_ft_home_team_win < odds_ft_draw) & (odds_ft_home_team_win < odds_ft_away_team_win)), "expected home wins", 
                        ifelse((odds_ft_draw < odds_ft_home_team_win) & (odds_ft_draw < odds_ft_away_team_win), "expected draw", "expected away win")))
```


